version: "3.8"
services:
    postgres:
        restart: unless-stopped
        build:
            context: ./db
            dockerfile: Dockerfile
        volumes:
            - type: volume
              source: bot-db
              target: /var/lib/postgresql/data
        environment:
            - POSTGRES_DB=postgres
            - POSTGRES_USER=postgres
            - POSTGRES_PASSWORD=${pg_password}
    bot:
        restart: unless-stopped
        build:
            context: .
            dockerfile: Dockerfile
        command: ["./wait-for-it.sh", "postgres:5432", "--", "poetry", "run", "python", "bot.py"]
        env_file:
            - .env
volumes:
    bot-db: null